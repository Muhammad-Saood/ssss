<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Professional Python Code Runner with Tabs</title>
    <!-- Bootstrap CSS for styling and tabs -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- CodeMirror CSS for code editor -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/dracula.min.css"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }
      .container {
        max-width: 1200px;
        margin-top: 20px;
      }
      .editor-container {
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-bottom: 15px;
      }
      .output-container {
        background-color: #282a36;
        color: #f8f8f2;
        padding: 15px;
        border-radius: 5px;
        min-height: 150px;
        font-family: 'Courier New', monospace;
        white-space: pre-wrap;
        overflow: auto;
      }
      .run-btn {
        background-color: #28a745;
        border: none;
      }
      .run-btn:hover {
        background-color: #218838;
      }
      .run-btn:disabled {
        background-color: #6c757d;
      }
      .cm-editor {
        border-radius: 5px;
        min-height: 300px;
      }
      .tab-content > .tab-pane {
        padding: 15px;
        background-color: #fff;
        border: 1px solid #dee2e6;
        border-top: none;
        border-radius: 0 0 5px 5px;
      }
      .error-message {
        color: #dc3545;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="text-center mb-4">Professional Python Code Runner with Multiple Tabs</h1>
      <p class="text-center text-muted mb-4">
        Use tabs to work on and run multiple Python codes independently.
      </p>

      <!-- Tabs Navigation -->
      <ul class="nav nav-tabs" id="codeTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="tab1-tab" data-bs-toggle="tab" data-bs-target="#tab1" type="button" role="tab" aria-controls="tab1" aria-selected="true">Tab 1</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="tab2-tab" data-bs-toggle="tab" data-bs-target="#tab2" type="button" role="tab" aria-controls="tab2" aria-selected="false">Tab 2</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="tab3-tab" data-bs-toggle="tab" data-bs-target="#tab3" type="button" role="tab" aria-controls="tab3" aria-selected="false">Tab 3</button>
        </li>
      </ul>

      <!-- Tabs Content -->
      <div class="tab-content" id="codeTabsContent">
        <!-- Tab 1 -->
        <div class="tab-pane fade show active" id="tab1" role="tabpanel" aria-labelledby="tab1-tab">
          <div class="editor-container mb-3">
            <textarea id="code1" class="form-control">
print("Hello from Tab 1!")
# Example: Calculate sum of a list
numbers = [1, 2, 3, 4, 5]
print(sum(numbers))
            </textarea>
          </div>
          <button id="run-btn1" class="btn btn-success run-btn mb-3" onclick="runCode(1)">Run Code</button>
          <div>
            <h5>Output:</h5>
            <div id="output1" class="output-container"></div>
          </div>
        </div>

        <!-- Tab 2 -->
        <div class="tab-pane fade" id="tab2" role="tabpanel" aria-labelledby="tab2-tab">
          <div class="editor-container mb-3">
            <textarea id="code2" class="form-control">
print("Hello from Tab 2!")
import math
print(math.sqrt(16))
            </textarea>
          </div>
          <button id="run-btn2" class="btn btn-success run-btn mb-3" onclick="runCode(2)">Run Code</button>
          <div>
            <h5>Output:</h5>
            <div id="output2" class="output-container"></div>
          </div>
        </div>

        <!-- Tab 3 -->
        <div class="tab-pane fade" id="tab3" role="tabpanel" aria-labelledby="tab3-tab">
          <div class="editor-container mb-3">
            <textarea id="code3" class="form-control">
print("Hello from Tab 3!")
for i in range(5):
    print(i)
            </textarea>
          </div>
          <button id="run-btn3" class="btn btn-success run-btn mb-3" onclick="runCode(3)">Run Code</button>
          <div>
            <h5>Output:</h5>
            <div id="output3" class="output-container"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- CodeMirror JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/python/python.min.js"></script>
    <script>
      // Initialize CodeMirror for each tab
      const editors = {};
      for (let i = 1; i <= 3; i++) {
        const codeTextarea = document.getElementById(`code${i}`);
        editors[i] = CodeMirror.fromTextArea(codeTextarea, {
          mode: "python",
          theme: "dracula",
          lineNumbers: true,
          indentUnit: 4,
          matchBrackets: true,
        });
      }

      const JUDGE0_API_URL = "https://judge0-ce.p.rapidapi.com/submissions";
      const API_KEY = "1f2fd0e93dmsh63d4fb2cf9d3b83p1ad2b8jsnd18e2e024f9f"; // Added as requested - REGENERATE AND SECURE IN PRODUCTION

      async function runCode(tabId) {
        const editor = editors[tabId];
        const output = document.getElementById(`output${tabId}`);
        const runBtn = document.getElementById(`run-btn${tabId}`);

        output.textContent = "Running...\n";
        runBtn.disabled = true;
        runBtn.textContent = "Running...";

        const code = editor.getValue();

        try {
          // Step 1: Submit code to Judge0
          const submissionResponse = await fetch(`${JUDGE0_API_URL}?base64_encoded=true`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-RapidAPI-Key": API_KEY,
              "X-RapidAPI-Host": "judge0-ce.p.rapidapi.com",
            },
            body: JSON.stringify({
              source_code: btoa(code),
              language_id: 71, // Python 3.8.1
            }),
          });

          if (!submissionResponse.ok) {
            const errorText = await submissionResponse.text();
            throw new Error(
              `Submission failed with status ${submissionResponse.status}: ${errorText}\n` +
              `Check your API key in RapidAPI dashboard[](https://rapidapi.com/judge0-official/api/judge0-ce).`
            );
          }

          const submission = await submissionResponse.json();

          if (!submission.token) {
            output.textContent += "Error: No submission token received. Verify API key and endpoint.\n";
            return;
          }

          // Step 2: Poll for results
          let result;
          let attempts = 0;
          const maxAttempts = 20;
          while (attempts < maxAttempts) {
            await new Promise((resolve) => setTimeout(resolve, 1000));
            const resultResponse = await fetch(`${JUDGE0_API_URL}/${submission.token}?base64_encoded=true`, {
              headers: {
                "X-RapidAPI-Key": API_KEY,
                "X-RapidAPI-Host": "judge0-ce.p.rapidapi.com",
              },
            });

            if (!resultResponse.ok) {
              const errorText = await resultResponse.text();
              throw new Error(`Polling failed with status ${resultResponse.status}: ${errorText}`);
            }

            result = await resultResponse.json();

            if (result.status.id !== 1 && result.status.id !== 2) {
              break;
            }
            attempts++;
          }

          if (attempts >= maxAttempts) {
            output.textContent += "Error: Execution timed out after polling.\n";
            return;
          }

          // Step 3: Display output
          output.textContent = "";
          const stdout = result.stdout ? atob(result.stdout) : "";
          const stderr = result.stderr ? atob(result.stderr) : "";
          const compileOutput = result.compile_output ? atob(result.compile_output) : "";
          const message = result.message ? atob(result.message) : "";

          if (stdout) output.textContent += `Output:\n${stdout}\n`;
          if (stderr) output.textContent += `Errors:\n${stderr}\n`;
          if (compileOutput) output.textContent += `Compile Output:\n${compileOutput}\n`;
          if (message) output.textContent += `Message:\n${message}\n`;
          output.textContent += `Status: ${result.status.description}\n`;
          output.textContent += `Time: ${result.time} seconds\n`;
          output.textContent += `Memory: ${result.memory} KB\n`;

          if (!stdout && !stderr && !compileOutput && !message) {
            output.textContent += "No output generated.\n";
          }
        } catch (err) {
          output.textContent += `Error: ${err.message}\n`;
          output.textContent += `Troubleshooting:\n- Ensure API key is valid (check RapidAPI dashboard).\n- Check network connectivity.\n- Verify quota (100 requests/day on free tier).\n- Test API directly with curl or Postman.\n`;
        } finally {
          runBtn.disabled = false;
          runBtn.textContent = "Run Code";
        }
      }
    </script>
  </body>
</html>
